# Bailey Gateway â€“ Project State

## STATUS
Backend functional. Core BACnet read/write, config overlay, and basic trending working.

## WORKING
- Network discovery (WHO-IS / I-AM) with cache + UDP port separation
- Point discovery per device
- AO write (WriteProperty) with:
  - Priority support
  - NULL relinquish works
- BO write (WriteProperty) with:
  - Priority support
  - NULL relinquish works
- Priority behavior differs per controller (expected BACnet behavior)
- Override endpoint stable
- Point config persistence (JSON-based)
- UI overlay on live points:
  - alias
  - unit_override
  - ui_type
- Trend endpoint:
  - Appends timestamped samples
  - Returns full series per point

## INTENTIONAL DESIGN
- `scale` / `offset` are **UI-only** (do NOT affect BACnet writes)
- Backend writes always use raw BACnet values
- UI conversions handled client-side (or via config overlay only)
- Junk BACpypes scripts still used for writes (not removed yet)

## FILES OF RECORD
- bailey_gateway/main.py
- bailey_gateway/core/bacnet_core.py
- bailey_gateway/core/points_store.py
- bailey_gateway/core/trend_store.py
- bailey_gateway/models/schemas.py
- bailey_gateway/data/points.json
- bailey_gateway/data/trends.json

## KNOWN BEHAVIOR
- Some devices ignore lower priorities if higher is active
- NULL relinquish restores lower priority control when supported
- Discovery may fall back to cache when UDP busy (by design)

## NEXT STEPS (ORDERED)
1. Decide trend sampling model (poll interval vs on-demand)
2. Add trend windowing (last N minutes / samples)
3. Frontend (Swift) trend graph consumption
4. Optional: replace junk write scripts with in-process BACnet stack

Resume from this PROJECT_STATE.md. Do not add new features unless I ask.
